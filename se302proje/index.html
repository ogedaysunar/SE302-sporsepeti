<!DOCTYPE HTML>
<!--
	Editorial by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>SporSepetim</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<link rel="icon" type="image/png" href="images/icons/mainicon.png"/>
		<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	</head>
	<body style="margin:0;" class="is-preload">
		<div id="loader"></div>
	<div style="display:none;" class="animate-bottom" id="myDiv">
		<!-- Wrapper -->
			<div id="wrapper">


				<!-- Main -->
					<div id="main">
						<div class="inner">

							<!-- Header -->
								<header id="header">
									<a href="index.html" class="logo"><strong>SporSepetim</strong></a>
									<ul id="userIcon" class="icons">
										<li><input style="height:30px;" type="text" name="query" id="email" placeholder="Email" /></li>
										<li><input style="height:30px;" type="password" name="query" id="password" placeholder="Şifre" /></li>

										<li><a style="font-size:18px" onclick="login1()" class="icon fa-arrow-circle-o-right"></a></li>
										<br><li><a onclick='resetSifre()' style='font-size:10px'>Şifremi Unuttum.</a></li>
										<!--<li><a href="#" class="icon fa-user"><span class="label">Twitter</span></a></li>
										<li><a href="#" class="icon fa-power-off"><span class="label">Facebook</span></a></li>
										<li><a href="#" class="icon fa-enter"><span class="label">Instagram</span></a></li> -->
									</ul>
								</header>

							<!-- Banner -->
								<section id="banner">
									<div class="content">
										<header>
											<h1>Hoşgeldiniz !<br />
											</h1>
											<p>Neden SporSepetim ?</p>
										</header>
										<p>Aenean ornare velit lacus, ac varius enim ullamcorper eu. Proin aliquam facilisis ante interdum congue. Integer mollis, nisl amet convallis, porttitor magna ullamcorper, amet egestas mauris. Ut magna finibus nisi nec lacinia. Nam maximus erat id euismod egestas. Pellentesque sapien ac quam. Lorem ipsum dolor sit nullam.</p>
										<ul class="actions">
											<li><a id="kayitButton" href="register.html" class="button big">Kayıt Ol</a></li>
										</ul>
									</div>
									<span class="image object">
										<div class="imageDiv">
										<div class="mainContainer2">
											<br><br>
											<div class="container2">
												<div id="myCarousel" class="carousel slide" data-ride="carousel">
													<!-- Indicators -->

													<ol class="carousel-indicators">
														<li data-target="#myCarousel" data-slide-to="0" class="active"></li>
														<li data-target="#myCarousel" data-slide-to="1"></li>
														<li data-target="#myCarousel" data-slide-to="2"></li>
													</ol>

													<!-- Wrapper for slides -->
													<div class="carousel-inner">
														<div class="item active">
															<img src="images/mainpic1.jpg" style="width:100%;height:250px;">
														</div>

														<div class="item">
															<img src="images/mainpic1.jpg" style="width:100%;height:250px;">
														</div>

														<div class="item">
															<img src="images/mainpic1.jpg" style="width:100%;height:250px;">
														</div>
													</div>

													<!-- Left and right controls -->
													<a class="left carousel-control" href="#myCarousel" data-slide="prev">
														<span class="glyphicon glyphicon-chevron-left"></span>
														<span class="sr-only">Geri</span>
													</a>
													<a class="right carousel-control" href="#myCarousel" data-slide="next">
														<span class="glyphicon glyphicon-chevron-right"></span>
														<span class="sr-only">İleri</span>
													</a>
												</div>
											</div>
									</span>
								</section>


								<section>
									<header class="major">
										<h2>Popüler Spor Salonları</h2>
									</header>
									<div id="sportcentersList" class="posts">
									</div>
								</section>

								<section>
									<header class="major">
										<h2>Popüler Eğitmenler</h2>
									</header>
									<div id="trainerList" class="posts">
									</div>
								</section>

						</div>
					</div>

				<!-- Sidebar -->
					<div id="sidebar">
						<div class="inner">

							<!-- Search -->
								<section id="search" class="alt">
									<form method="post" action="#">
										<input type="text" name="query" id="query" placeholder="Ara" />
									</form>
								</section>

							<!-- Menu -->
								<nav id="menu">
									<header class="major">
										<h2>Menu</h2>
									</header>
									<ul>
										<li><a href="index.html">Anasayfa</a></li>
										<li><a href="#">Hakkımızda</a></li>
										<li><a href="sportcenters.html">Spor Salonları</a></li>
										<li><a href="trainers.html">Eğitmenler</a></li>
										<li><a href="#">İletişim</a></li>
									</ul>
								</nav>


								<section>
									<header class="major">
										<h2>İletişim</h2>
									</header>
									<p>
										Herhangi bir konuda şikayet etmek, bilgi almak veya fikirlerinizi bizimle paylaşmak
									için aşağıdaki e-mail ile bize ulaşabilirsiniz.</p>
									<ul class="contact">
										<li class="fa-envelope-o"><a href="#">info@sporsepetim.com</a></li>
										<li class="fa-phone">(212) 567-9822</li>
										<li class="fa-home">1234 Akaretler #8254<br />
										İstanbul, TR 00000-0000</li>
									</ul>
								</section>

							<!-- Footer -->
								<footer id="footer">
									<p class="copyright">&copy; SE302-Team. All rights reserved.</p>
								</footer>

						</div>
					</div>

			</div>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>
			<script src="https://www.gstatic.com/firebasejs/5.9.1/firebase.js"></script>
			<script src="assets/js/db.js"></script>

			<script>

			var userNameAsString = "";
			firebase.auth().onAuthStateChanged(function(user) {
				if (user) {
					if(!user.emailVerified){
						alert("Lütfen size gönderdiğimiz e-maili onaylayınız. E-mail tekrar yollanmıştır.");
						sendEmailVerification();
						logout1();
						notLoading();
					}else{
						// WE REMOVE LOGIN INPUTS AND ADDING USER ICON, USER NAME.
						document.getElementById("kayitButton").innerHTML = "daha fazla"
						document.getElementById("kayitButton").onclick = function(){ alert("Eklenecek.");}
						document.getElementById("kayitButton").href = "resimyukle.html"
						// User is signed in.
						firebase.database().ref("Users").on("child_added",function(snapshot2){
							firebase.database().ref("Users").child(snapshot2.key).child(user.uid).on("value", function(snapshot){
								userNameAsString = snapshot.val().name
								document.getElementById("userIcon").innerHTML = "<li><a onclick='logout1()' class='icon fa-power-off'></a></li><li><a href='editprofile.html' class='icon fa-user'><br>" + userNameAsString + "</a></li>"
							});
							notLoading();
						});
					}
				} else {
					// No user is signed in.
					// We put login inputs again.
					document.getElementById("userIcon").innerHTML = "<li><input style='height:30px' type='text' name='query' id='email' placeholder='Email'/></li><li><input style='height:30px' type='password' name='query' id='password' placeholder='Şifre'/></li><li><a style='font-size:18px' onclick='login1()' class='icon fa-arrow-circle-o-right'></a></li><br><li><a onclick='resetSifre()' style='font-size:10px'>Şifremi Unuttum.</a></li>"
					// WE CHANGE KATITBUTTON VALUE.
					document.getElementById("kayitButton").innerHTML = "Kayıt Ol"
					document.getElementById("kayitButton").href = "register.html"
					notLoading();
				}
			});

				//----------------- LOGİN RESET PASSWORD AND LOGOUT START. -------------------//
			function login1(){
				var email = document.getElementById("email").value;
				var password = document.getElementById("password").value;
				if(validateEmail(email)){
					showLoading();
					firebase.auth().signInWithEmailAndPassword(email, password).catch(function(error) {
						// Handle Errors here.

						var errorCode = error.code;
						var errorMessage = error.message;
						if (errorCode == 'auth/internal-error') {
							alert('Sunucumuz beklenmeyen bir hata ile karşılaştı. Lütfen tekrar deneyiniz.');
						}else if(errorCode == 'auth/email-already-exists'){
							alert("Girdiğiniz e-mail başkası tarafından kullanılıyor. Lütfen başka bir e-mail giriniz.");
						}else if(errorCode == 'auth/wrong-password'){
							alert('Hatalı Şifre!');
						}else{
							alert("Bir hata oluştu. Sayfayı yenileyip tekrar deneyiniz.");
						}

						notLoading();
					});
				}else{
					alert("Lütfen geçerli bir e-mail girin.");
					notLoading();
				}
			}

			// VERIFICATION E-MAIL
	    function sendEmailVerification() {
	      // START sendemailverification
	      firebase.auth().currentUser.sendEmailVerification().then(function() {
	        // Email Verification sent!
	      });
	      //END
	    }

			function resetSifre(){
				var emailKontrol = false;
  			var resetEmail = prompt("Lütfen E-mailinizi giriniz.");
				sendPasswordReset(resetEmail);
			}

			function sendPasswordReset(email) {
      	// [START sendpasswordemail]
      	firebase.auth().sendPasswordResetEmail(email).then(function() {
        	// Password Reset Email Sent!
        	alert('Şifre resetleme e-mailinize gönderilmiştir.');
      		}).catch(function(error) {
        	// Handle Errors here.
        	var errorCode = error.code;
        	var errorMessage = error.message;
        		if (errorCode == 'auth/invalid-email') {
          		alert("Lütfen geçerli bir e-mail giriniz.");
        		} else if (errorCode == 'auth/user-not-found') {
          		alert("Böyle bir kullanıcı bulunmamaktadır.");
        		}
        			console.log(error);
      	});
				// END
    	}

			function logout1(){
      firebase.auth().signOut().then(function() {
        console.log('Signed Out');
      }, function(error) {
        console.error('Sign Out Error', error);
      });
    }

		// valid email
			function validateEmail(email) {
    	var re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
    	return re.test(String(email).toLowerCase());
		}

		//----------------- LOGİN RESET PASSWORD AND LOGOUT FINISH. -------------------//

		//----------------- LOADING ICON START. -------------------//
		function notLoading() {
      document.getElementById("loader").style.display = "none";
      document.getElementById("myDiv").style.display = "block";
    }

    function showLoading() {
      document.getElementById("loader").style.display = "block";
      document.getElementById("myDiv").style.display = "none";
    }
		//----------------- LOADING ICON FINISH. -------------------//

		//----------------- VİEW POPULAR TRAINER START. -------------------//
		function getPopularTrainers(){
			const egitmenListesi = document.querySelector("#trainerList");
			firebase.database().ref("Users").child("Trainers").on("child_added",function(snapshot){
				egitmenListesi.innerHTML += "<article><a href='#' class='image'><img style='width:200px;height:200px' id='" + snapshot.key + "' src='images/emptyUser.jpg'/></a><h3>" + snapshot.val().name + " " + snapshot.val().surname + "</h3><p>" + snapshot.val().info + "</p><ul class='actions'><li><a onclick='sendUserKey(\"" + snapshot.key + "\")' class='button'>İncele</a></li></ul></article>"
				getPopularTrainersImage(snapshot.key);
			});
		}
		getPopularTrainers();

		function getPopularTrainersImage(uid){
			//showLoading(); // RESİM İNDİRME DENEME..
		  var storageRef = firebase.storage().ref();
		  var starsRef = storageRef.child('trainers/' + uid);
		  // Get the download URL
		  starsRef.getDownloadURL().then(function(url) {
		  // Insert url into an <img> tag to "download"
		  if(url.includes(uid)){
				document.getElementById(uid).src = url;
				notLoading();
		  }
			notLoading();
		  }).catch(function(error) {
		  switch (error.code) {
		    case 'storage/object_not_found':
		      // File doesn't exist
		      alert("Üzgünüz. Dosya bulunamıyor.");
		      break;
		    case 'storage/unauthorized':
		      // User doesn't have permission to access the object
		      alert("Bu resmi çekmenize izniniz yok.");
		      break;
		    case 'storage/canceled':
		      // User canceled the upload
		      alert("Beklenmeyen bir hata oluştu. Lütfen daha sonra tekrar deneyiniz.");
		      break;
		    case 'storage/unknown':
		      // Unknown error occurred, inspect the server response
		      alert("Lütfen bizimle iletişime geçiniz");
		      break;
		  }
		});
		}

		// send the key for view the popular trainer profile.
		function sendUserKey(userKey){
			console.log(userKey);
   		sessionStorage.setItem('label', userKey);
			window.location.href = "file:///Users/ogedaysunar/Documents/GitHub/SE302-sporsepeti/se302proje/profil.html";
		}

		//----------------- VİEW POPULAR TRAINER FINISH. -------------------//
		//******************************************************************//

		//----------------- VİEW POPULAR SPORT CENTER START. -------------------//
		function getPopularSportCenters(){
			const sportCentersList = document.querySelector("#sportcentersList");
			firebase.database().ref("SportCenters").on("child_added",function(snapshot){
				firebase.database().ref("SportCenters").child(snapshot.key).on("value",function(snapshot2){
					sportCentersList.innerHTML += "<article><a href='#' class='image'><img style='width:200px;height:200px' id='" + snapshot2.key + "' src='images/emptyUser.jpg'/></a><h3>" + snapshot2.val().salonName + "</h3><p>" + snapshot2.val().salonaciklama + "</p><ul class='actions'><li><a onclick='sendSportCenterKey(\"" + snapshot.key + "\")' class='button'>İncele</a></li></ul></article>"
					getPopularTSportCentersImage(snapshot.key);
				});
			});
		}
		getPopularSportCenters();

		function getPopularTSportCentersImage(sportcentersKey){
			//showLoading(); // RESİM İNDİRME DENEME..
		  var storageRef = firebase.storage().ref();
		  var starsRef = storageRef.child('sportcenters/' + sportcentersKey);
		  // Get the download URL
		  starsRef.getDownloadURL().then(function(url) {
		  // Insert url into an <img> tag to "download"
		  if(url.includes(sportcentersKey)){
				document.getElementById(sportcentersKey).src = url;
				notLoading();
		  }
			notLoading();
		  }).catch(function(error) {
		  switch (error.code) {
		    case 'storage/object_not_found':
		      // File doesn't exist
		      alert("Üzgünüz. Dosya bulunamıyor.");
		      break;
		    case 'storage/unauthorized':
		      // User doesn't have permission to access the object
		      alert("Bu resmi çekmenize izniniz yok.");
		      break;
		    case 'storage/canceled':
		      // User canceled the upload
		      alert("Beklenmeyen bir hata oluştu. Lütfen daha sonra tekrar deneyiniz.");
		      break;
		    case 'storage/unknown':
		      // Unknown error occurred, inspect the server response
		      alert("Lütfen bizimle iletişime geçiniz");
		      break;
		  }
		});
		}
		//----------------- VİEW POPULAR SPORT CENTER FINISH. -------------------//
		// send the key for view the popular sport center profile.
		function sendUserKey(centerKey){
   		sessionStorage.setItem('label2', centerKey);
			window.location.href = "file:///Users/ogedaysunar/Documents/GitHub/SE302-sporsepeti/se302proje/sporcenter.html";
		}


			</script>

	</body>
</html>
