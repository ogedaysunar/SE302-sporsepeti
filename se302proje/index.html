<!DOCTYPE HTML>
<html>
	<head>
		<title>SporSepetim</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<link rel="icon" type="image/png" href="images/icons/mainicon.png"/>
		<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	</head>
	<body style="margin:0;" class="is-preload">
		<div id="loader"></div>
	<div style="display:none;" class="animate-bottom" id="myDiv">
		<!-- Wrapper -->
			<div id="wrapper">


				<!-- Main -->
					<div id="main">
						<div class="inner">

							<!-- Header -->
								<header id="header">
									<a href="index.html" class="logo"><strong>SporSepetim</strong></a>
									<ul id="userIcon" class="icons">
										<li><input style="height:30px;" type="text" name="query" id="email" placeholder="Email" /></li>
										<li><input style="height:30px;" type="password" name="query" id="password" placeholder="Şifre" /></li>

										<li><a style="font-size:18px" onclick="login1()" class="icon fa-arrow-circle-o-right"></a></li>
										<br><li><a onclick='resetSifre()' style='font-size:10px'>Şifremi Unuttum.</a></li>
										<!--<li><a href="#" class="icon fa-user"><span class="label">Twitter</span></a></li>
										<li><a href="#" class="icon fa-power-off"><span class="label">Facebook</span></a></li>
										<li><a href="#" class="icon fa-enter"><span class="label">Instagram</span></a></li> -->
									</ul>
								</header>

							<!-- Banner -->
								<section id="banner">
									<div class="content">
										<header>
											<h1>Hoşgeldiniz !<br />
											</h1>
											<p id="nedenSporSepetim">Neden SporSepetim ?</p>
										</header>
										<p id="altBaslik">neden spor sepetimle ilgili bir yazı.</p>
										<ul class="actions">
											<li><a id="kayitButton" href="register.html" class="button big">Kayıt Ol</a></li>
											<li><a id="students" href="myStudents.html" class="button big" hidden>Öğrencilerim</a></li>
											<li><a id="sporsalonlarım" href="" class="button big" hidden>Spor Salonlarım</a></li>
											<li><a id="aramaButton1" href="" class="button big" hidden>Eğitmenlerim</a></li>
											<li><a id="myProgramsButton" href="" class="button big" hidden>Spor Programlarım</a></li>
										</ul>
									</div>
									<span class="image object">
										<div class="imageDiv">
										<div class="mainContainer2">
											<br><br>
											<div class="container2">
												<div id="myCarousel" class="carousel slide" data-ride="carousel">
													<!-- Indicators -->

													<ol class="carousel-indicators">
														<li data-target="#myCarousel" data-slide-to="0" class="active"></li>
														<li data-target="#myCarousel" data-slide-to="1"></li>
														<li data-target="#myCarousel" data-slide-to="2"></li>
													</ol>

													<!-- Wrapper for slides -->
													<div class="carousel-inner">
														<div class="item active">
															<img src="images/mainpic1.jpg" style="width:100%;height:250px;">
														</div>

														<div class="item">
															<img src="images/mainpic1.jpg" style="width:100%;height:250px;">
														</div>

														<div class="item">
															<img src="images/mainpic1.jpg" style="width:100%;height:250px;">
														</div>
													</div>

													<!-- Left and right controls -->
													<a class="left carousel-control" href="#myCarousel" data-slide="prev">
														<span class="glyphicon glyphicon-chevron-left"></span>
														<span class="sr-only">Geri</span>
													</a>
													<a class="right carousel-control" href="#myCarousel" data-slide="next">
														<span class="glyphicon glyphicon-chevron-right"></span>
														<span class="sr-only">İleri</span>
													</a>
												</div>
											</div>
									</span>
								</section>


								<section>
									<header class="major">
										<h2>Bazı Spor Salonları</h2>
									</header>
									<div id="sportcentersList" class="posts">
									</div>
								</section>

								<section>
									<header class="major">
										<h2>Bazı Eğitmenler</h2>
									</header>
									<div id="trainerList" class="posts">
									</div>
								</section>

						</div>
					</div>

				<!-- Sidebar -->
					<div id="sidebar">
						<div class="inner">

							<!-- Menu -->
								<nav id="menu">
									<header class="major">
										<h2>Menu</h2>
									</header>
									<ul>
										<li><a href="index.html">Anasayfa</a></li>
										<li><a href="hakkimizda.html">Hakkımızda</a></li>
										<li><a href="sportcenters.html">Spor Salonları</a></li>
										<li><a href="trainers.html">Eğitmenler</a></li>
									</ul>
								</nav>


								<section>
									<header class="major">
										<h2>İletişim</h2>
									</header>
									<p>
										Herhangi bir konuda şikayet etmek, bilgi almak veya fikirlerinizi bizimle paylaşmak
									için aşağıdaki e-mail ile bize ulaşabilirsiniz.</p>
									<ul class="contact">
										<li class="fa-envelope-o"><a href="#">info@sporsepetim.com</a></li>
										<li class="fa-phone">(212) 567-9822</li>
										<li class="fa-home">1234 Akaretler #8254<br />
										İstanbul, TR 00000-0000</li>
									</ul>
								</section>

							<!-- Footer -->
								<footer id="footer">
									<p class="copyright">&copy; SE302-Team. All rights reserved.</p>
								</footer>

						</div>
					</div>

			</div>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>
			<script src="https://www.gstatic.com/firebasejs/5.9.1/firebase.js"></script>
			<script src="assets/js/db.js"></script>

			<script>


			/**
			 * auth onAuthStateChanged function is a firebase function. This function checks if the user is online.
			 */

			var userNameAsString = "";
			firebase.auth().onAuthStateChanged(function(user) {
				if (user) {
					if(!user.emailVerified){
						alert("Lütfen size gönderdiğimiz e-maili onaylayınız. E-mail tekrar yollanmıştır.");
						sendEmailVerification();
						logout1();
						notLoading();
					}else{
						// User is signed in.
						//what is the user status ?
						var userID = user.uid;
						firebase.database().ref("Users").on("child_added",function(snapshot){
							firebase.database().ref("Users").child(snapshot.key).on("child_added",function(snapshot3){
								if(snapshot3.key == userID){
									firebase.database().ref("Users").child(snapshot.key).child(userID).on("value",function(snapshot2){
										userNameAsString = snapshot2.val().name + " " + snapshot2.val().surname + "(" + snapshot2.val().status + ")"
										document.getElementById("userIcon").innerHTML = "<li><a onclick='logout1()' class='icon fa-power-off'></a></li><li><a href='editprofile.html' class='icon fa-user'><br>" + userNameAsString + "</a></li>"
										if(snapshot2.val().status == "Managers"){
											// WE REMOVE LOGIN INPUTS AND ADDING USER ICON, USER NAME.
											document.getElementById("kayitButton").innerHTML = "Spor Salonu Oluştur"
											document.getElementById("sporsalonlarım").style.display = "block";
											document.getElementById("sporsalonlarım").href = "mysportcenters.html";
											document.getElementById("kayitButton").href = "creategym.html"
											document.getElementById("nedenSporSepetim").innerHTML = "Spor Salonu Oluşturmadan Önce Dikkat Edilmesi Gerekenler"
											document.getElementById("altBaslik").innerHTML = "Spor salonu oluşturmak için ilk olarak, oluşturduğunuz spor salonunun var olup olmadığını doğrulamamız gerekiyor. Bu yüzden spor salonu oluştururken, spor salonu bilgilerinizi çok dikkatli ve eksiksiz girmeye özen gösteriniz. Aksi taktirde isteğiniz sistemimiz tarafından onaylanmayacaktır."
										}else if(snapshot2.val().status == "Trainers"){
											document.getElementById("kayitButton").innerHTML = "Spor Programı Oluştur"
											document.getElementById("students").style.display = "block";
											document.getElementById("kayitButton").href = "createProgram.html"
											document.getElementById("nedenSporSepetim").innerHTML = "Spor Programı Oluşturmadan Önce Dikkat Edilmesi Gerekenler"
											document.getElementById("altBaslik").innerHTML = "Spor programı oluşturmak için ilk olarak, oluşturduğunuz spor programı kullanıcının isteklerine uyuyor mu uymuyor mu diye kontrol etmeniz gerekiyor. Bu yüzden spor programı oluştururken, spor programı içeriğini çok dikkatli ve eksiksiz girmeye özen gösteriniz. Aksi taktirde kullanıcının isteklerine uymuyorsa sistemimiz tarafından onaylanmayacaktır ve sizinle iletişime geçilmek durumunda kalınacaktır."
										}else if(snapshot2.val().status == "Users"){
											document.getElementById("kayitButton").innerHTML = "Spor Salonum"
											document.getElementById("aramaButton1").style.display = "block"
											document.getElementById("kayitButton").href = "mySportCenters.html"
											document.getElementById("aramaButton1").href = "myTrainers.html"
											document.getElementById("myProgramsButton").style.display = "block"
											document.getElementById("myProgramsButton").href = "viewProgram.html"
											document.getElementById("altBaslik").innerHTML = "Spor Salonu veya Spor Eğiteni arayıp, isteklerinize uygun salonlara kayıt olabilir, isteklerinize uygun eğitmenler ile iletişime geçip, onların öğrenicisi olabilirsiniz :)"
										}else{
											window.location.href = "admin.html";
										}
									});
									notLoading();
								}
							});
							notLoading();
						});
					}
				} else {
					// No user is signed in.
					// We put login inputs again.
					document.getElementById("userIcon").innerHTML = "<li><input style='height:30px' type='text' name='query' id='email' placeholder='Email'/></li><li><input style='height:30px' type='password' name='query' id='password' placeholder='Şifre'/></li><li><a style='font-size:18px' onclick='login1()' class='icon fa-arrow-circle-o-right'></a></li><br><li><a onclick='resetSifre()' style='font-size:10px'>Şifremi Unuttum.</a></li>"
					// WE CHANGE KATITBUTTON VALUE.
					document.getElementById("kayitButton").innerHTML = "Kayıt Ol"
					document.getElementById("kayitButton").href = "register.html"
					notLoading();
				}
			});

			function logout1(){
				// trainers search button is hidden
				document.getElementById("aramaButton1").style.display = "none"
				document.getElementById("myProgramsButton").style.display = "none"
				document.getElementById("students").style.display = "none"
				document.getElementById("nedenSporSepetim").innerHTML = "Neden SporSepetim ?"
				document.getElementById("altBaslik").innerHTML = "neden spor sepetimle ilgili bir yazı."
				document.getElementById("sporsalonlarım").style.display = "none";

		    firebase.auth().signOut().then(function() {
		      console.log('Signed Out');
		    }, function(error) {
		      console.error('Sign Out Error', error);
		    });
    	}

		//----------------- LOGİN RESET PASSWORD AND LOGOUT FINISH. -------------------//


		//----------------- VİEW POPULAR TRAINER START. -------------------//

		/**
		 * getPopularTrainers function get popular trainers informations.
		 */
		function getPopularTrainers(){
			const egitmenListesi = document.querySelector("#trainerList");
			firebase.database().ref("Users").child("Trainers").on("child_added",function(snapshot){
				egitmenListesi.innerHTML += "<article><a href='#' class='image'><img style='width:200px;height:200px' id='" + snapshot.key + "' src='images/emptyUser.jpg'/></a><h3>" + snapshot.val().name + " " + snapshot.val().surname + "</h3><p>" + snapshot.val().myDescription + "</p><ul class='actions'><li><a onclick='sendUserKey(\"" + snapshot.key + "\")' class='button'>İncele</a></li></ul></article>"
				getPopularTrainersImage(snapshot.key);
			});
		}
		getPopularTrainers();



		/**
		 * getPopularTrainersImage function get popular trainers images.
		 */

		function getPopularTrainersImage(uid){
			//showLoading(); // RESİM İNDİRME DENEME..
		  var storageRef = firebase.storage().ref();
		  var starsRef = storageRef.child('trainers/' + uid);
		  // Get the download URL
		  starsRef.getDownloadURL().then(function(url) {
		  // Insert url into an <img> tag to "download"
		  if(url.includes(uid)){
				document.getElementById(uid).src = url;
				notLoading();
		  }
			notLoading();
		  }).catch(function(error) {
		  switch (error.code) {
		    case 'storage/object_not_found':
		      // File doesn't exist
		      alert("Üzgünüz. Dosya bulunamıyor.");
		      break;
		    case 'storage/unauthorized':
		      // User doesn't have permission to access the object
		      alert("Bu resmi çekmenize izniniz yok.");
		      break;
		    case 'storage/canceled':
		      // User canceled the upload
		      alert("Beklenmeyen bir hata oluştu. Lütfen daha sonra tekrar deneyiniz.");
		      break;
		    case 'storage/unknown':
		      // Unknown error occurred, inspect the server response
		      alert("Lütfen bizimle iletişime geçiniz");
		      break;
		  }
		});
		}

		// send the key for view the popular trainer profile.

		/**
		 * sendUserKey function sends the user's id.
		 */
		function sendUserKey(userKey){
			console.log(userKey);
   		sessionStorage.setItem('label', userKey);
			window.location.href = "profil.html";
		}

		//----------------- VİEW POPULAR TRAINER FINISH. -------------------//
		//******************************************************************//

		//----------------- VİEW POPULAR SPORT CENTER START. -------------------//

		/**
		 * getPopularSportCenters function get popular sport centers informations.
		 */
		function getPopularSportCenters(){
			const sportCentersList = document.querySelector("#sportcentersList");
			firebase.database().ref("SportCenters").on("child_added",function(snapshot){
				firebase.database().ref("SportCenters").child(snapshot.key).on("value",function(snapshot2){
					if(snapshot2.val().status){
						sportCentersList.innerHTML += "<article><a href='#' class='image'><img style='width:200px;height:200px' id='" + snapshot2.key + "' src='images/emptyUser.jpg'/></a><h3>" + snapshot2.val().salonName + "</h3><p>" + snapshot2.val().salonaciklama + "</p><ul class='actions'><li><a onclick='sendSportCenterKey(\"" + snapshot.key + "\")' class='button'>İncele</a></li></ul></article>"
						getPopularTSportCentersImage(snapshot.key);
					}
				});
			});
		}
		getPopularSportCenters();


		/**
		 * getPopularTSportCentersImage function get popular sport centers images.
		 */
		function getPopularTSportCentersImage(sportcentersKey){
			//showLoading(); // RESİM İNDİRME DENEME..
		  var storageRef = firebase.storage().ref();
		  var starsRef = storageRef.child('sportcenters/' + sportcentersKey);
		  // Get the download URL
		  starsRef.getDownloadURL().then(function(url) {
		  // Insert url into an <img> tag to "download"
		  if(url.includes(sportcentersKey)){
				document.getElementById(sportcentersKey).src = url;
				notLoading();
		  }
			notLoading();
		  }).catch(function(error) {
		  switch (error.code) {
		    case 'storage/object_not_found':
		      // File doesn't exist
		      alert("Üzgünüz. Dosya bulunamıyor.");
		      break;
		    case 'storage/unauthorized':
		      // User doesn't have permission to access the object
		      alert("Bu resmi çekmenize izniniz yok.");
		      break;
		    case 'storage/canceled':
		      // User canceled the upload
		      alert("Beklenmeyen bir hata oluştu. Lütfen daha sonra tekrar deneyiniz.");
		      break;
		    case 'storage/unknown':
		      // Unknown error occurred, inspect the server response
		      alert("Lütfen bizimle iletişime geçiniz");
		      break;
		  }
		});
		}
		//----------------- VİEW POPULAR SPORT CENTER FINISH. -------------------//
		// send the key for view the popular sport center profile.

		/**
		 * sendSportCenterKey function sends the user's id.
		 */
		function sendSportCenterKey(centerKey){
   		sessionStorage.setItem('label2', centerKey);
			window.location.href = "sporcenter.html";
		}


			</script>

	</body>
</html>
