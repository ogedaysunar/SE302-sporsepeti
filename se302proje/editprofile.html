<!DOCTYPE HTML>
<!--
	Editorial by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>SporSepetim</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<link rel="icon" type="image/png" href="images/icons/mainicon.png"/>
		<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	</head>
	<body style="margin:0;" class="is-preload">
		<div id="loader"></div>
		<div style="display:none;" class="animate-bottom" id="myDiv">
		<!-- Wrapper -->
			<div id="wrapper">

				<!-- Main -->
					<div id="main">
						<div class="inner">

							<!-- Header -->
								<header id="header">
									<a href="index.html" class="logo"><strong>SporSepetim</strong></a>
									<ul id="userIcon" class="icons">
										<li><input style="height:30px;" type="text" name="query" id="email" placeholder="Email" /></li>
										<li><input style="height:30px;" type="password" name="query" id="password" placeholder="Şifre" /></li>

										<li><a style="font-size:18px" onclick="login1()" class="icon fa-arrow-circle-o-right"></a></li>
										<br><li><a onclick='resetSifre()' style='font-size:10px'>Şifremi Unuttum.</a></li>
										<!--<li><a href="#" class="icon fa-user"><span class="label">Twitter</span></a></li>
										<li><a href="#" class="icon fa-power-off"><span class="label">Facebook</span></a></li>
										<li><a href="#" class="icon fa-enter"><span class="label">Instagram</span></a></li> -->
									</ul>
								</header>

							<!-- Content -->
								<!-- burdan -->
								<div class="container1">
  							<textarea placeholder="Describe yourself here..."></textarea>
								<img id="denemeimg" src="images/emptyUser.jpg" alt="profile-sample4" class="profile" style="width:200px;height:200px" />
								<div id="filesubmit">
						      <input type="file" class="file-select" accept="image/*"/>
						      <progress id="uploader" value="0" max="100">0%</progress>
						      <button class="file-submit">Yükle</button>
						    </div>


							</div>

				          <div class="line-separator"></div>
                  <form class="" action="editprofile.html" method="post">
                    <div class="container">



                      <div class="form-item col-2">
                        <h1>Kişisel Bilgiler</h1>
                        <div class="custom-input active">
                          <label>Ad</label>
                            <input id="name" class="validate-item data-hj-whitelist" type="text" />
                        </div>

                        <div class="custom-input active">
                          <label>Soyad</label>
                            <input class="validate-item data-hj-whitelist" id="surname" name="LastName" type="text" />

                        </div>


                    <div class="form-item">
                        <div class="custom-input active">
                          <label>Email</label>
                            <input class="validate-item email data-hj-whitelist" id="email" name="Email" type="text" />

                        </div>
                    </div>
                    <div class="form-item">
                        <div class="custom-input">
                            <label>Doğum Tarihi</label>
                            <input class="birthdate data-hj-whitelist" data-val="true" data-val-date="The field BirthDate must be a date." id="BirthDate" name="BirthDate" type="text" value="" />

                        </div>
                    </div>
                    <div class="form-item">
                        <div class="custom-input">
                          <label>Telefon Numarası</label>
                            <input class="phone data-hj-whitelist" id="phone" name="Phone" type="text" value="" />

                        </div>
                    </div>

                    <div class="form-item">
                        <div class="custom-input">
                          <label>Okul</label>
                            <input class="school data-hj-whitelist" id="School" name="School" type="text" value="" />
                        </div>
                    </div>

                    <div class="form-item">
                        <div class="custom-input">
                          <label>Sports</label>
                            <input class="sports data-hj-whitelist" id="Sports" name="Sports" type="text" value="" />
                        </div>
                    </div>

                    <div class="form-item">
                        <div class="custom-input">
                          <label>Dereceler/Lisanslar</label>
                            <input class="achieve data-hj-whitelist" id="Achieve" name="Achieve" type="text" value="" />
                        </div>
                    </div>

                    <div class="form-item">
                        <div class="custom-input">
                          <label>Hobiler</label>
                            <input class="hobbies data-hj-whitelist" id="Hobbies" name="Hobbies" type="text" value="" />
                        </div>
                    </div>

                    </div>

                    </div>

                    <div class="container">
                      <input type="submit" value="Kaydet">
                    </div>
            </form>
								<!-- buraya -->
				<!-- Sidebar -->
					<div id="sidebar">
						<div class="inner">

							<!-- Search -->
								<section id="search" class="alt">
									<form method="post" action="#">
										<input type="text" name="query" id="query" placeholder="Search" />
									</form>
								</section>

							<!-- Menu -->
								<nav id="menu">
									<header class="major">
										<h2>Menu</h2>
									</header>
									<ul>
										<li><a href="index.html">Anasayfa</a></li>
										<li><a href="#">Hakkımızda</a></li>
										<li><a href="sportcenters.html">Spor Salonları</a></li>
										<li><a href="trainers.html">Eğitmenler</a></li>
										<li><a href="#">İletişim</a></li>

								</nav>

							<!-- Section -->
								<section>
									<header class="major">
										<h2>Ante interdum</h2>
									</header>
									<div class="mini-posts">
										<article>
											<a href="#" class="image"><img src="images/pic07.jpg" alt="" /></a>
											<p>Aenean ornare velit lacus, ac varius enim lorem ullamcorper dolore aliquam.</p>
										</article>
										<article>
											<a href="#" class="image"><img src="images/pic08.jpg" alt="" /></a>
											<p>Aenean ornare velit lacus, ac varius enim lorem ullamcorper dolore aliquam.</p>
										</article>
										<article>
											<a href="#" class="image"><img src="images/pic09.jpg" alt="" /></a>
											<p>Aenean ornare velit lacus, ac varius enim lorem ullamcorper dolore aliquam.</p>
										</article>
									</div>
									<ul class="actions">
										<li><a href="#" class="button">More</a></li>
									</ul>
								</section>

							<!-- Section -->
								<section>
									<header class="major">
										<h2>Get in touch</h2>
									</header>
									<p>Sed varius enim lorem ullamcorper dolore aliquam aenean ornare velit lacus, ac varius enim lorem ullamcorper dolore. Proin sed aliquam facilisis ante interdum. Sed nulla amet lorem feugiat tempus aliquam.</p>
									<ul class="contact">
										<li class="fa-envelope-o"><a href="#">information@untitled.tld</a></li>
										<li class="fa-phone">(000) 000-0000</li>
										<li class="fa-home">1234 Somewhere Road #8254<br />
										Nashville, TN 00000-0000</li>
									</ul>
								</section>

							<!-- Footer -->
								<footer id="footer">
									<p class="copyright">&copy; Untitled. All rights reserved. Demo Images: <a href="https://unsplash.com">Unsplash</a>. Design: <a href="https://html5up.net">HTML5 UP</a>.</p>
								</footer>

						</div>
					</div>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>


			<script src="https://www.gstatic.com/firebasejs/5.9.1/firebase.js"></script>
	    <script>
	    // Initialize Firebase
	      var config = {
	      apiKey: "AIzaSyDL--Ni0Jcno-IcsDefYq64ZHZQAi2gnsc",
	      authDomain: "sporsepeti-65ea9.firebaseapp.com",
	      databaseURL: "https://sporsepeti-65ea9.firebaseio.com",
	      projectId: "sporsepeti-65ea9",
	      storageBucket: "sporsepeti-65ea9.appspot.com",
	      messagingSenderId: "932394206290"
	    };
	    firebase.initializeApp(config);
	    </script>

	  <script>

	firebase.auth().onAuthStateChanged(function(user) {
	if (user) {
	  // User is signed in.
		firebase.database().ref("Kullanıcılar").on("child_added",function(snapshot2){
			firebase.database().ref("Kullanıcılar").child(snapshot2.key).on("child_added", function(snapshot){
				if(snapshot.key == user.uid){
					userNameAsString = snapshot.val().name + " " + snapshot.val().surname
					document.getElementById("userIcon").innerHTML = "<li><a onclick='logout1()' class='icon fa-power-off'></a></li><li><a href='editprofile.html' class='icon fa-user'><br>" + userNameAsString + "</a></li>"
				}
			});

		});

		getPopularTrainersImage(user.uid);
		getInfo(user.uid);
		notLoading();


	} else {
	  // No user is signed in.

		window.location.href = "file:///Users/ogedaysunar/Documents/GitHub/SE302-sporsepeti/se302proje/index.html";
	}
	});

	//----------------- LOADING ICON START. -------------------//
	function notLoading() {
		document.getElementById("loader").style.display = "none";
		document.getElementById("myDiv").style.display = "block";
	}

	function showLoading() {
		document.getElementById("loader").style.display = "block";
		document.getElementById("myDiv").style.display = "none";
	}
	//----------------- LOADING ICON FINISH. -------------------//

	function getPopularTrainersImage(uid){
		showLoading(); // RESİM İNDİRME DENEME..
	  var storageRef = firebase.storage().ref();
	  var starsRef = storageRef.child('trainers/' + uid);
	  // Get the download URL
	  starsRef.getDownloadURL().then(function(url) {
	  // Insert url into an <img> tag to "download"
	  if(url.includes(uid)){
	    document.getElementById("denemeimg").src = url;

	  }
		notLoading();
	  }).catch(function(error) {
	  switch (error.code) {
	    case 'storage/object_not_found':
	      // File doesn't exist
	      alert("Üzgünüz. Dosya bulunamıyor.");
	      break;
	    case 'storage/unauthorized':
	      // User doesn't have permission to access the object
	      alert("Bu resmi çekmenize izniniz yok.");
	      break;
	    case 'storage/canceled':
	      // User canceled the upload
	      alert("Beklenmeyen bir hata oluştu. Lütfen daha sonra tekrar deneyiniz.");
	      break;
	    case 'storage/unknown':
	      // Unknown error occurred, inspect the server response
	      alert("Lütfen bizimle iletişime geçiniz");
	      break;
	  }
	});
	}

	// RESİM YÜKLEME -------------------->
	const storageService = firebase.storage();
	const storageRef = storageService.ref();

	document.querySelector('.file-select').addEventListener('change', handleFileUploadChange);
	document.querySelector('.file-submit').addEventListener('click', handleFileUploadSubmit);

	var selectedFile;
	  function handleFileUploadChange(e) {
	    selectedFile = e.target.files[0];
	}

	function handleFileUploadSubmit(e) {
	  var user = firebase.auth().currentUser;
	  var downloadURL = "";
	  console.log(user.uid);
	  const uploadTask = storageRef.child('trainers/' + user.uid).put(selectedFile); //create a child directory called images, and place the file inside this directory
	  uploadTask.on('state_changed', (snapshot) => {
	    var percentage = (snapshot.bytesTransferred/snapshot.totalBytes)*100;
	    uploader.value = percentage;

	  }, (error) => {
	    // Handle unsuccessful uploads
	    console.log(error);
	  }, () => {
	    // Do something once upload is complete
	    //document.getElementById("yuklemeBildirim").innerHTML = "Resminiz eklenmiştir.";
	    console.log('success');
			location.reload();
			e.target.files[0] = "";
	  });
	}
	// RESİM YÜKLEME BİTTİ -------------->

	function getInfo(uid){
		firebase.database().ref("Kullanıcılar").on("child_added",function(snapshot){
			firebase.database().ref("Kullanıcılar").child(snapshot.key).on("child_added",function(snapshot2){
				if(snapshot2.key == uid){
					document.getElementById("name").value = snapshot2.val().name
					document.getElementById("surname").value = snapshot2.val().surname
					document.getElementById("email").value = snapshot2.val().email
					document.getElementById("phone").value = snapshot2.val().phone
				}
			});
		});
	}

	function logout1(){
	firebase.auth().signOut().then(function() {
		console.log('Signed Out');
	}, function(error) {
		console.error('Sign Out Error', error);
	});
}

	</script>

	</body>
</html>
